<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phân Tích Hiệu Quả - CTC SolarAnalytics</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- === HEADER ĐÃ ĐƯỢC THÊM VÀO === -->
    <header class="bg-white/90 backdrop-blur-md sticky top-0 z-50 shadow-md transition duration-300">
        <nav class="container mx-auto max-w-6xl px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2">

                <img src="Image/logo_rm_bgr.png" alt="Logo SolarAnalytics" class="h-8" />

                <span class="text-xl font-bold text-gray-800">SolarAnalytics</span>

            </a>
            <div class="flex items-center gap-4">
                <div class="hidden md:flex items-center gap-4 font-medium text-gray-700">
                    <a href="index.html" class="nav-link">Trang Chủ</a>
                    <a href="about.html" class="nav-link">Về chúng tôi</a>
                    <a href="services.html" class="nav-link">Dịch vụ</a>
                    <a href="projects.html" class="nav-link">Dự án</a>
                    <a href="phan_tich.html" class="nav-link active" data-translate-key="navAnalysis">Phân Tích</a>
                    <a href="lich_su.html" class="nav-link" data-translate-key="navHistory">Lịch Sử</a>
                </div>
                <div class="flex items-center border-l pl-4 gap-2 text-sm text-gray-500">
                    <span id="lang-vi" class="lang-switcher cursor-pointer">VI</span>
                    <span>|</span>
                    <span id="lang-en" class="lang-switcher cursor-pointer">EN</span>
                </div>
                <a href="phan_tich.html" class="md:hidden bg-blue-600 text-white font-semibold py-2.5 px-5 rounded-md hover:bg-blue-700 transition duration-300 text-sm">Phân tích ngay</a>
            </div>
        </nav>
    </header>

    <main id="app-container" class="container mx-auto max-w-6xl p-4 sm:p-6">
        <div id="analysis-page-content">
            <div id="analysis-form-container" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold text-center mb-8 text-gray-800" data-translate-key="surveyTitle">Thông Tin Phân Tích</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-12 gap-y-8">
                    <div class="space-y-8">
                        <fieldset class="form-fieldset">
                            <legend class="form-legend" data-translate-key="customerInfoTitle">Thông tin khách hàng</legend>
                            <div class="space-y-4">
                                <div>
                                    <label for="survey-name" class="form-label" data-translate-key="surveyNameLabel">Tên khách hàng / Doanh nghiệp</label>
                                    <div class="input-group">
                                        <span class="input-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                                        </span>
                                        <input type="text" id="survey-name" class="form-input" required>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="survey-phone" class="form-label" data-translate-key="surveyPhoneLabel">Số điện thoại</label>
                                        <div class="input-group">
                                            <span class="input-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                            </span>
                                            <input type="tel" id="survey-phone" class="form-input">
                                        </div>
                                    </div>
                                    <div>
                                        <label for="survey-email" class="form-label" data-translate-key="surveyEmailLabel">Email</label>
                                        <div class="input-group">
                                            <span class="input-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                            </span>
                                            <input type="email" id="survey-email" class="form-input">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label for="survey-address" class="form-label" data-translate-key="surveyAddressLabel">Địa chỉ lắp đặt</label>
                                    <textarea id="survey-address" class="form-input" rows="2"></textarea>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="survey-customer-type" class="form-label" data-translate-key="surveyCustomerTypeLabel">Đối tượng khách hàng</label>
                                        <select id="survey-customer-type" class="form-input">
                                            <option value="Hộ gia đình" data-translate-key="customerTypeHousehold">Hộ gia đình</option>
                                            <option value="Kinh doanh" data-translate-key="customerTypeBusiness">Kinh doanh</option>
                                            <option value="Sản xuất" data-translate-key="customerTypeProduction">Sản xuất</option>
                                            <option value="Hành chính sự nghiệp" data-translate-key="customerTypeAdmin">Hành chính sự nghiệp</option>
                                        </select>
                                    </div>
                                     <div>
                                        <label for="survey-region" class="form-label" data-translate-key="surveyRegionLabel">Vùng miền</label>
                                        <select id="survey-region" class="form-input">
                                            <option value="Miền Trung/Nam" data-translate-key="regionCentralSouth">Miền Trung/Nam</option>
                                            <option value="Miền Bắc" data-translate-key="regionNorth">Miền Bắc</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>

                    <div class="space-y-8">
                        <fieldset class="form-fieldset">
                            <legend class="form-legend" data-translate-key="consumptionTitle">Thông số Tiêu thụ</legend>
                            <div class="flex border-b mb-4">
                                <button id="tab-kwh" class="tab-btn active" data-translate-key="tabKwh">Theo kWh</button>
                                <button id="tab-vnd" class="tab-btn" data-translate-key="tabVnd">Theo Tiền Điện</button>
                            </div>
                            <div id="panel-kwh" class="tab-panel active">
                                <label for="monthly-kwh" class="form-label" data-translate-key="monthlyKwhLabel">Lượng điện tiêu thụ/tháng (kWh)</label>
                                <input type="text" inputmode="numeric" id="monthly-kwh" class="form-input" data-translate-placeholder-key="monthlyKwhPlaceholder">
                            </div>
                            <div id="panel-vnd" class="tab-panel">
                                <div class="space-y-4">
                                    <div>
                                        <label for="monthly-bill" class="form-label" data-translate-key="monthlyBillLabel">Tiền điện trung bình/tháng (VNĐ)</label>
                                        <input type="text" inputmode="numeric" id="monthly-bill" class="form-input">
                                    </div>
                                    <div class="text-center my-2 text-gray-500 text-sm font-semibold" data-translate-key="orEnter12MonthsDetail">HOẶC NHẬP CHI TIẾT 12 THÁNG</div>
                                    <div id="monthly-bills-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3">
                                    </div>
                                    <div class="flex justify-end items-center gap-4 pt-2 border-t">
                                         <span class="font-bold" data-translate-key="totalLabel">Tổng:</span>
                                         <span id="total-12-months" class="font-bold text-lg text-blue-600">0 VNĐ</span>
                                    </div>
                                </div>
                            </div>
                        </fieldset>

                        <fieldset class="form-fieldset">
                            <legend class="form-legend" data-translate-key="systemCostTitle">Thông số Hệ thống & Chi phí</legend>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="investment-cost" class="form-label" data-translate-key="costPerKwpLabel">Chi phí / kWp (VNĐ)</label>
                                        <input type="text" inputmode="numeric" id="investment-cost" class="form-input" value="15000000">
                                    </div>
                                    <div>
                                        <label for="panel-wattage" class="form-label" data-translate-key="panelWattageLabel">Công suất pin (Wp)</label>
                                        <input type="number" id="panel-wattage" class="form-input" value="550">
                                    </div>
                                </div>
                                <div>
                                    <label for="system-type" class="form-label" data-translate-key="systemTypeLabel">Loại hệ thống</label>
                                    <select id="system-type" class="form-input">
                                        <option value="Hòa lưới" data-translate-key="systemTypeGridTied">Hòa lưới</option>
                                        <option value="Hybrid" data-translate-key="systemTypeHybrid">Hybrid</option>
                                    </select>
                                </div>
                                <div id="hybrid-cost-section" class="form-section">
                                    <label for="storage-investment-cost" class="form-label" data-translate-key="storageCostLabel">Chi phí / kWh lưu trữ (VNĐ)</label>
                                    <input type="text" inputmode="numeric" id="storage-investment-cost" class="form-input" value="18000000">
                                </div>
                                <div>
                                    <label for="day-usage-ratio" class="form-label mb-2"><span data-translate-key="dayUsageRatioLabel">Tỷ lệ sử dụng ban ngày</span>: <span id="day-usage-value" class="font-bold text-blue-600">90%</span></label>
                                    <input type="range" id="day-usage-ratio" min="0" max="100" value="90" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-slider">
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <div id="calc-error-message" class="text-red-500 text-center mt-8 h-5 font-medium"></div>
                <div class="mt-8 flex justify-center">
                    <button id="calculate-btn" class="bg-blue-600 text-white font-bold py-3 px-10 rounded-full hover:bg-blue-700 transition duration-300 shadow-lg hover:shadow-blue-300 transform hover:scale-105 text-lg" data-translate-key="viewAnalysisButton">Tính Toán & Xem Phân Tích</button>
                </div>
            </div>

            <div id="result-container" class="hidden mt-8">
                <div id="report-content" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                    <div class="flex justify-between items-start mb-6 border-b pb-6">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800" data-translate-key="reportTitle">Báo Cáo Phân Tích Đầu Tư</h2>
                            <p id="report-customer-name" class="text-lg font-semibold text-blue-700"></p>
                            <p id="report-contact-info" class="text-sm text-gray-500"></p>
                            <p id="report-date" class="text-sm text-gray-400 mt-1"></p>
                        </div>
                        <button id="export-pdf-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            <span class="hidden sm:inline" data-translate-key="downloadPdfButton">Tải PDF</span>
                        </button>
                    </div>

                    <div class="mb-8 p-6 bg-gray-50 rounded-lg border">
                        <h3 class="text-xl font-bold mb-4" data-translate-key="surveyInfoTitle">Thông Tin Khảo Sát</h3>
                        <div id="survey-details" class="grid grid-cols-2 md:grid-cols-3 gap-y-4 gap-x-8 text-sm">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1 space-y-6">
                            <div class="card p-6">
                                <h3 class="text-xl font-bold mb-4" data-translate-key="recommendedSystemTitle">Hệ Thống Đề Xuất</h3>
                                <div id="system-details" class="space-y-4"></div>
                            </div>
                            <div class="card p-6">
                                <h3 class="text-xl font-bold mb-4" data-translate-key="envImpactTitle">Tác Động Môi Trường</h3>
                                <div id="env-details" class="space-y-4"></div>
                            </div>
                        </div>
                        <div class="lg:col-span-2 space-y-6">
                             <div class="card p-6">
                                <h3 class="text-xl font-bold mb-4" data-translate-key="financialAnalysisTitle">Phân Tích Tài Chính</h3>
                                <div id="financial-details" class="space-y-4"></div>
                            </div>
                             <div class="card p-6">
                                <h3 class="font-bold text-center mb-4" data-translate-key="billChartTitle">So Sánh Chi Phí Điện Hàng Tháng</h3>
                                <div class="chart-container">
                                    <canvas id="billChart"></canvas>
                                </div>
                            </div>
                             <div class="card p-6">
                                <h3 class="font-bold text-center mb-4" data-translate-key="paybackChartTitle">Phân Tích Dòng Tiền & Hoàn Vốn</h3>
                                <div class="chart-container">
                                    <canvas id="paybackChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 flex flex-col sm:flex-row gap-4">
                    <a href="phan_tich.html" class="flex-1 text-center bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700" data-translate-key="newAnalysisButton">Phân Tích Mới</a>
                    <a href="lich_su.html" class="flex-1 text-center bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300" data-translate-key="viewHistoryButton">Xem Lịch Sử</a>
                </div>
            </div>
        </div>
    </main>

    <!-- === FOOTER ĐÃ ĐƯỢC THÊM VÀO === -->
    <footer class="bg-gray-800 text-gray-300 py-8 text-center text-sm">
        <div class="container mx-auto max-w-6xl px-4">
            <div class="mb-4">
                <p class="font-semibold text-lg text-white">CÔNG TY CỔ PHẦN XÂY LẮP BƯU ĐIỆN MIỀN TRUNG (CTC)</p>
                <p class="mt-3">Địa chỉ: 50B Nguyễn Du, Phường Thạch Thang, Quận Hải Châu, TP. Đà Nẵng, Việt Nam</p>
                <p class="mt-1">Điện thoại: (0236) 3745 555 | Email: info@ctc.com.vn</p>
            </div>
            <div class="border-t border-gray-700 pt-4 mt-4">
                <p>&copy; 2004 - 2025 CTC. All rights reserved.</p>
                <p class="mt-2 text-xs text-gray-500">Người đại diện pháp luật: Ông Nguyễn Văn Duy - MST: 0400458940</p>
            </div>
        </div>
    </footer>

    <script src="translations.js"></script>
    <script src="script.js"></script>
</body>
</html>
